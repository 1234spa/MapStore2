#version: "3.8"
version: "3.3"

services:

  postgres:
    build:
      context: ./tests/
      dockerfile: DockerfilePostgresTest


  mapstore:
    build:
      dockerfile: ./tests/DockerfileMapStoreTest
      args:
        MAPSTORE_WEBAPP_SRC: ./mapstore.war
    environment:
      JAVA_OPTS: -Ddatadir.location=/mapstore/datadir
    volumes:
      - ./tests/geostore-datasource-ovr.properties:/mapstore/datadir/geostore-datasource-ovr.properties:rw
      - ./tests/plugin.json:/mapstore/datadir/configs/localConfig.json.patch:rw

  sut:
    build:
      context: ./tests/
      dockerfile: Dockerfile
    command: dockerize -wait tcp://postgres:5432 -wait tcp://mapstore:8080 -timeout 20s && python3 tests.py
    container_name: sutms
    env_file:
      - test-variables.env
    depends_on:
      - postgres
      - mapstore
      - proxy
    networks:
      - mapstore-network